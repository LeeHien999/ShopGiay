@model IEnumerable<ShopOnlineConnection.GioHang>
@using Microsoft.AspNet.Identity;
@using ShopOnlineConnection;
@using WebGiay.Models.BUS;
@using System.Web.Script.Serialization;

@{
    ViewBag.Title = "CheckOut";
    Layout = "~/Views/Shared/_MainLayout.cshtml";
}


<style>
    table {
        border-collapse: separate;
        border-spacing: 0 10px;
    }

    td {
        padding: 5px;
    }
</style>


<div class="breadcrumbs">
    <div class="container">
        <div class="row">
            <div class="col">
                <p class="bread"><span><a href="index.html">Home</a></span> / <span>Checkout</span></p>
            </div>
        </div>
    </div>
</div>

@{
    List<ChiTietDonHang> chitetdonhang = new List<ChiTietDonHang>();
   
}
<table hidden>

    <tr>
        <td>Subtotal</td>
        <td>@String.Format("{0:#,##0.##}đ", (decimal)ViewBag.TongTien)</td>
    </tr>
    @foreach (var item in Model)
    {
        <tr>
            <td>@item.SoLuong x @item.TenSanPham</td>
            <td>@String.Format("{0:#,##0.##}đ", (decimal)item.TongTien)</td>
        </tr>
        var sp = ShopOnlineBUS.LayThongTinMaSanPham(item.TenSanPham);
        chitetdonhang.Add(new ChiTietDonHang
        {
            IdSanPham = sp.MaSanPham,
            SoLuong = item.SoLuong,
            Gia = item.Gia,
        });
    }
    <tr>
        <td>Shipping</td>
        <td>0 đ</td>
    </tr>
    <tr>
        <td>Order Total</td>
        <td>@String.Format("{0:#,##0.##}đ", (decimal)ViewBag.TongTien)</td>
    </tr>
</table>

<div class="colorlib-product">
    <div class="container">
        <div class="row row-pb-lg">
            <div class="col-sm-10 offset-md-1">
                <div class="process-wrap">
                    <div class="process text-center active">
                        <p><span>01</span></p>
                        <h3>Shopping Cart</h3>
                    </div>
                    <div class="process text-center active">
                        <p><span>02</span></p>
                        <h3>Checkout</h3>
                    </div>
                    <div class="process text-center">
                        <p><span>03</span></p>
                        <h3>Order Complete</h3>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-8">

                @using (Html.BeginForm("CheckOut", "GioHang", FormMethod.Post))
                {

                    <h2>Billing Details</h2>
                    <div class="row">
                        <input name="iduser" value="@User.Identity.GetUserId()" hidden />
                        <input name="tongdonhang" value="@ViewBag.TongTien" hidden />
                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="Na">Tên Khách hàng</label>
                                <input type="text" name="tennguoinhan" class="form-control" placeholder="Tên Khách hàng" required>
                            </div>
                        </div>

                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="fname">Địa chỉ</label>
                                <input type="text" id="DiaChi" name="diachi" class="form-control" placeholder="Địa chỉ giao hàng" required>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="email">E-mail</label>
                                <input type="text" id="email" name="email" class="form-control" placeholder="Email" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="Phone">Số điện thoại</label>
                                <input type="text" id="zippostalcode" name="sdt" class="form-control" placeholder="Số điện thoại" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Payment: </label>
                            <select class="form-control" name="hinhthucthanhtoan" required>
                                <option value="COD">COD</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <div class="col-md-12">
                                <div class="checkbox">
                                    <label><input type="checkbox" value="" required> I have read and accept the terms and conditions</label>
                                </div>
                            </div>
                        </div>
                    </div>
                     JavaScriptSerializer serializer = new JavaScriptSerializer();
                     string json = serializer.Serialize(chitetdonhang);              
                    <input name="chitietdonhang" value="@json" hidden />
                    <div class="row">
                        <div class="col-md-12 text-center">
                            <p><input class="btn btn-primary" type="submit" value="Place an order" onclick="submitAllForm()" /></p>
                        </div>
                    </div>

                }

            </div>

            <div class="col-lg-4">
                <div class="row">
                    <div class="col-md-12">
                        <div class="cart-detail" style="width: 500px;">
                            <h2>Cart Total</h2>
                            <ul>
                                <li>
                                    <table>

                                        <tr>
                                            <td>Subtotal</td>
                                            <td>@String.Format("{0:#,##0.##}đ", (decimal)ViewBag.TongTien)</td>
                                        </tr>
                                        @foreach (var item in Model)
                                        {
                                            <tr>
                                                <td>@item.SoLuong x @item.TenSanPham</td>
                                                <td>@String.Format("{0:#,##0.##}đ", (decimal)item.TongTien)</td>
                                            </tr>

                                        }
                                        <tr>
                                            <td>Shipping</td>
                                            <td>0 đ</td>
                                        </tr>
                                        <tr>
                                            <td>Order Total</td>
                                            <td>@String.Format("{0:#,##0.##}đ", (decimal)ViewBag.TongTien)</td>
                                        </tr>
                                    </table>
                                </li>

                            </ul>
                        </div>
                    </div>
                    <div class="w-100"></div>

                </div>

            </div>
        </div>
    </div>
</div>

